---
title: "p8105_hw3_sh4354"
author: "Selina Hsuan"
date: "2023-10-10"
output: github_document
---

Load libraries

```{r}
library(tidyverse)
library(p8105.datasets)
```


## PROBLEM 1

```{r}
data("instacart")
```

The dataset `instacart` consists of 15 variables and 1384617 observations. It describes the products ordered through Instacart for several order numbers. 

```{r}
instacart |> 
  count(aisle) |> 
  arrange(desc(n)) |> 
  drop_na(aisle)
```

There are 124 aisles. The most items are ordered form fresh vegetales aisle. 



## PROBLEM 2

Load BRFSS dataset
```{r}
data("brfss_smart2010")
```

Clean dataset
```{r}
brfss_df = 
  brfss_smart2010 |> 
  janitor::clean_names() |> 
  separate(locationdesc, into = c("state", "county"), " - ") |> 
  select(-locationabbr) |> 
  filter(topic == "Overall Health") |> 
  arrange(response) |> 
  mutate(
    response = fct_relevel(response, c("Poor", "Fair", "Good", "Very good", "Excellent"))
  )

```


States observed at 7 or more locations in 2022

```{r}
brfss_df |> 
  filter(year == 2002) |> 
  group_by(state) |> 
  summarize(n_location = n()) |> 
  filter(n_location >=7)
```

In 2002, 36 states were observed at 7 or more locations. 


States observed at 7 or more locations in 2010

```{r}
brfss_df |> 
  filter(year == 2010) |> 
  group_by(state) |> 
  summarize(n_location = n()) |> 
  filter(n_location >=7)
```
In 2010, 45 states were observed at 7 or more locations. 


Create datafrome [excellent_df]
```{r}
excellent_df = 
  brfss_df |>
  filter(response == "Excellent") |> 
  group_by(year, state) |> 
  mutate(mean_data_value = mean(data_value, na.rm = TRUE)) |> 
  select (year, state, mean_data_value) |> 
  distinct()
```

Make spagetti plot of [excellent_df]
```{r}
excellent_df |> 
  ggplot(aes(x = year, y = mean_data_value, color = state)) + 
  geom_line() +
  labs(title = "Mean Data Values for Excellent Overall Health")
```

The spagetti plot shows the mean data values for excellent overall health in each state from 2022 to 2010. 

```{r}
nyc_df =
  brfss_df |>
  filter((year == 2006 | year == 2010) & state == "NY") |>
  select(year, response, data_value, county)
  
nyc_df |>
  ggplot(aes(x=response, y=data_value)) +
  geom_point() +
  facet_grid(. ~ year) + 
  labs(title = "NY State Overall Health")
```

The 2-panel plot shows the distribution of data values for each reponse from "poor" to "excellent" in NY state countries in the year 2006 and 2010. 



## PROBLEM 3

Clean demographic data
```{r}
demographic_df = 
  read_csv("./data/nhanes_covar.csv", skip = 4, na = ".") |> 
  janitor::clean_names() |> 
  mutate(
    sex = case_match(sex,
      1 ~ "male",
      2 ~ "female"),
    education = case_match(education,
      "1" ~ "less than high school",
      "2" ~ "high school equivalent", 
      "3" ~ "more than high school"),
    education = fct_relevel(education, 
      c("less than high school", "high school equivalent", "more than high school"))
  ) |> 
  filter(age >= 21) |> 
  drop_na()
```

Clean accelorometer data
```{r}
accelorometer_df = 
  read_csv("./data/nhanes_accel.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(
    min1:min1440,
    names_to = "minute",
    names_prefix = "min",
    values_to = "mims"
  ) 
```

Merge demographic and accelorometer data 
```{r}
nhanes_df = 
  inner_join(demographic_df, accelorometer_df)
```


Education table 
```{r}
demographic_df |> 
  group_by(education, sex) |> 
  summarize(n_sex = n()) |> 
  pivot_wider(
    names_from = sex,
    values_from = n_sex
  ) |> 
  knitr::kable()
```

Age distribution by sex
```{r}
demographic_df |> 
  ggplot(aes(x = education, y = age, color = sex)) + 
  geom_boxplot() +
  labs(title = "Age Distribution")
```

Total Activity
```{r}
nhanes_df |> 
  group_by(seqn, age, sex, education) |> 
  summarize(total_activity = sum(mims)) |> 
  ggplot(aes(x = age, y = total_activity, color = sex)) + 
  geom_point() +
  geom_smooth() +
  facet_grid(. ~ education) + 
  labs(title = "Total Activity")
```

Activity over the course of day
```{r}
nhanes_df |>
  mutate(
    minute = as.numeric(minute)
  ) |> 
  ggplot(aes(x = minute, y = mims, color = sex)) + 
  geom_point(alpha = 0.5) +
  facet_grid(. ~ education) + 
  labs(title = "Activity Over the Course of a Day")
```

